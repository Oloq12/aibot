<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçë Peach Mini - AI –°–ø—É—Ç–Ω–∏–∫–∏</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: #111116;
            color: white;
            overflow-x: hidden;
            width: 100%;
            max-width: 420px;
            margin: 0 auto;
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* HEADER - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0 */
        .header {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 16px;
            background: linear-gradient(to bottom, rgba(0, 0, 0, 0.5), transparent);
            flex-shrink: 0;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: white;
            cursor: pointer;
        }

        .logo .mini {
            background: linear-gradient(to right, #f093fb, #667eea);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* MAIN CONTENT */
        .main {
            flex-grow: 1;
            overflow-y: auto;
            padding-bottom: 80px;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* WELCOME - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0 */
        .welcome {
            text-align: center;
            padding-top: 16px;
        }

        .welcome h1 {
            font-size: 1.875rem;
            font-weight: bold;
            color: white;
            margin-bottom: 8px;
        }

        .welcome p {
            color: #9ca3af;
            margin-top: 8px;
        }

                 /* CHARACTER GALLERY - —Ç–æ—á–Ω–∞—è –∫–æ–ø–∏—è v0 —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å—é */
         .gallery {
             width: 100%;
             height: 360px;
             display: flex;
             align-items: center;
             justify-content: center;
             position: relative;
             margin: 8px 0;
         }

         .gallery-container {
             position: relative;
             width: 100%;
             height: 288px;
             perspective: 1000px;
         }

         .carousel {
             position: absolute;
             width: 100%;
             height: 100%;
             transition: transform 1000ms cubic-bezier(0.4, 0, 0.2, 1);
             transform-style: preserve-3d;
             cursor: grab;
             user-select: none;
             -webkit-user-select: none;
             -moz-user-select: none;
             -ms-user-select: none;
         }

         .carousel:active {
             cursor: grabbing;
         }

        .character-card {
            position: absolute;
            width: 192px;
            height: 288px;
            transition: transform 500ms cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            border-radius: 24px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            transition: all 500ms cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .card-inner.center {
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(236, 72, 153, 0.3);
            transform: scale(1.05);
        }

        .card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.9;
        }

        .card-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.8), transparent);
        }

        .card-content {
            position: absolute;
            bottom: 0;
            left: 0;
            padding: 12px;
            color: white;
        }

        .card-emoji {
            font-size: 1.25rem;
        }

        .card-name {
            font-size: 1.25rem;
            font-weight: bold;
            margin-top: 4px;
        }

        .card-age {
            font-weight: 300;
        }

        .card-personality {
            font-size: 0.75rem;
            color: #d1d5db;
            margin-top: 4px;
        }

        /* CREATE BUTTON - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0 */
        .create-button {
            margin: 24px 16px;
            width: calc(100% - 32px);
            height: 56px;
            font-size: 1.125rem;
            font-weight: bold;
            background: linear-gradient(135deg, #f093fb, #667eea);
            transition: opacity 0.3s;
            border-radius: 16px;
            color: white;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }

        .create-button:hover {
            opacity: 0.9;
        }

                 .fish-icon {
             width: 24px;
             height: 24px;
         }

         /* DYNAMIC TEXT ANIMATION */
         #dynamicText {
             transition: opacity 0.3s ease;
             display: inline-block;
         }

        /* CHARACTER CATALOG - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0 */
        .catalog {
            padding: 0 16px 16px;
        }

        .filters {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .filter-button {
            border-radius: 9999px;
            transition: all 0.3s;
            background: rgba(255, 255, 255, 0.1);
            color: #d1d5db;
            border: none;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 0.875rem;
        }

        .filter-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .filter-button.active {
            background: linear-gradient(135deg, #ec4899, #f97316);
            color: white;
        }

        .catalog-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 16px;
        }

        /* CREATE COMPANION CARD - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0 */
        .create-companion-card {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            cursor: pointer;
            border: 1px dashed rgba(255, 255, 255, 0.2);
            transition: border-color 0.3s;
            aspect-ratio: 3/4;
        }

        .create-companion-card:hover {
            border-color: #ec4899;
        }

        .create-companion-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
            opacity: 0.5;
            transition: opacity 0.3s;
        }

        .create-companion-card:hover .create-companion-image {
            opacity: 0.7;
        }

        .create-companion-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(131, 24, 67, 0.5), rgba(88, 28, 135, 0.5));
        }

        .create-companion-content {
            position: absolute;
            inset: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: white;
            padding: 16px;
        }

        .create-fish-icon {
            width: 48px;
            height: 48px;
            color: #f472b6;
        }

        .create-companion-title {
            font-weight: bold;
            font-size: 1.125rem;
            margin-top: 8px;
        }

        /* CATALOG CHARACTER CARD - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0 */
        .catalog-card {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            aspect-ratio: 3/4;
        }

        .catalog-card-image {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .catalog-card-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0, 0, 0, 0.7), transparent);
        }

        .catalog-card-tag {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(4px);
            color: white;
            font-size: 0.75rem;
            padding: 4px 8px;
            border-radius: 9999px;
        }

        .catalog-card-info {
            position: absolute;
            bottom: 8px;
            left: 8px;
            color: white;
        }

        .catalog-card-name {
            font-weight: bold;
        }

        .catalog-card-age {
            font-weight: 300;
        }

        .catalog-card-add {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 28px;
            height: 28px;
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(4px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            border: none;
            cursor: pointer;
            transition: background 0.3s;
        }

        .catalog-card-add:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        /* BOTTOM NAVIGATION - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0 */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 100%;
            max-width: 420px;
            display: flex;
            align-items: center;
            justify-content: space-around;
            padding: 8px;
            background: rgba(0, 0, 0, 0.2);
            backdrop-filter: blur(24px);
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            flex-shrink: 0;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 4px;
            color: #9ca3af;
            text-decoration: none;
            cursor: pointer;
            transition: color 0.3s;
        }

        .nav-item:hover {
            color: white;
        }

        .nav-item.active {
            color: #f472b6;
        }

        .nav-item.create {
            width: 64px;
            height: 40px;
            background: linear-gradient(135deg, #f093fb, #667eea);
            border-radius: 12px;
            color: white;
            box-shadow: 0 10px 15px -3px rgba(240, 147, 251, 0.2);
        }

        .nav-icon {
            width: 24px;
            height: 24px;
            margin-bottom: 2px;
        }

        .nav-text {
            font-size: 0.75rem;
            margin-top: 4px;
        }

        .nav-dot {
            width: 4px;
            height: 4px;
            background: #f472b6;
            border-radius: 50%;
            margin-top: 4px;
        }

        @media (max-width: 420px) {
            .character-card {
                width: 160px;
                height: 240px;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER -->
    <header class="header">
        <div class="logo" onclick="navigateTo('home')">
            üçë Peach<span class="mini">Mini</span>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <main class="main">
        <!-- HOME PAGE -->
        <div id="page-home" class="page active">
            <div class="welcome">
                <h1>–ù–∞–π–¥–∏ —Å–≤–æ—é –ø–∞—Ä—É</h1>
                <p>–ù–∞—á–Ω–∏ –æ–±—â–∞—Ç—å—Å—è —Å AI-–∫–æ–º–ø–∞–Ω—å–æ–Ω–∞–º–∏</p>
            </div>

            <!-- CHARACTER GALLERY -->
            <div class="gallery">
                <div class="gallery-container">
                    <div class="carousel" id="carousel">
                        <!-- Characters will be added via JS -->
                    </div>
                </div>
            </div>

                         <!-- CREATE BUTTON -->
             <button class="create-button" onclick="navigateTo('create')">
                 <svg class="fish-icon" viewBox="0 0 24 24" fill="currentColor">
                     <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2ZM21 9V7L15 1L13.5 2.5L16.17 5.17C15.24 5.06 14.32 5 13.4 5C10.94 5 8.5 5.64 6.35 6.85L8.1 8.6C9.5 8.06 11 7.79 12.5 7.79C15.5 7.79 18.39 8.94 20.66 11.21L21 9Z"/>
                 </svg>
                 –°–æ–∑–¥–∞–π—Ç–µ <span id="dynamicText">—Å–≤–æ–µ–≥–æ —Å–ø—É—Ç–Ω–∏–∫–∞</span>
             </button>

            <!-- CHARACTER CATALOG -->
            <div class="catalog">
                <div class="filters">
                    <button class="filter-button active" onclick="filterCatalog('–í—Å–µ –º–æ–¥–µ–ª–∏')">–í—Å–µ –º–æ–¥–µ–ª–∏</button>
                    <button class="filter-button" onclick="filterCatalog('–†–µ–∞–ª—å–Ω—ã–π')">–†–µ–∞–ª—å–Ω—ã–π</button>
                    <button class="filter-button" onclick="filterCatalog('–ê–Ω–∏–º–µ')">–ê–Ω–∏–º–µ</button>
                </div>
                <div class="catalog-grid" id="catalog-grid">
                    <!-- Catalog will be populated via JS -->
                </div>
            </div>
        </div>

        <!-- CHAT PAGE -->
        <div id="page-chat" class="page">
            <div style="padding: 20px; text-align: center;">
                <h2>üí¨ –ß–∞—Ç</h2>
                <p style="color: #9ca3af; margin-top: 8px;">–í–∞—à–∏ –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–∏–∞–ª–æ–≥–∏</p>
            </div>
        </div>

        <!-- CREATE PAGE -->
        <div id="page-create" class="page">
            <div style="padding: 20px; text-align: center;">
                <h2>üé® –°–æ–∑–¥–∞—Ç—å</h2>
                <p style="color: #9ca3af; margin-top: 8px;">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ —Å–ø—É—Ç–Ω–∏–∫–∞</p>
            </div>
        </div>

        <!-- GENERATE PAGE -->
        <div id="page-generate" class="page">
            <div style="padding: 20px; text-align: center;">
                <h2>‚ú® –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</h2>
                <p style="color: #9ca3af; margin-top: 8px;">–°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã</p>
            </div>
        </div>

        <!-- COMPANIONS PAGE -->
        <div id="page-companions" class="page">
            <div style="padding: 20px; text-align: center;">
                <h2>‚≠ê –ö–æ–º–ø–∞–Ω—å–æ–Ω—ã</h2>
                <p style="color: #9ca3af; margin-top: 8px;">–í–∞—à–∏ —Å–æ–∑–¥–∞–Ω–Ω—ã–µ –ø–µ—Ä—Å–æ–Ω–∞–∂–∏</p>
            </div>
        </div>
    </main>

    <!-- BOTTOM NAVIGATION -->
    <nav class="bottom-nav">
        <a class="nav-item active" onclick="navigateTo('home')">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
            </svg>
            <span class="nav-text">–î–æ–º–æ–π</span>
            <div class="nav-dot"></div>
        </a>
        
        <a class="nav-item" onclick="navigateTo('chat')">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-2 12H6v-2h12v2zm0-3H6V9h12v2zm0-3H6V6h12v2z"/>
            </svg>
            <span class="nav-text">–ß–∞—Ç</span>
        </a>
        
        <a class="nav-item create" onclick="navigateTo('create')">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor" style="width: 20px; height: 20px;">
                <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2Z"/>
            </svg>
            <span class="nav-text">–°–æ–∑–¥–∞—Ç—å</span>
        </a>
        
        <a class="nav-item" onclick="navigateTo('generate')">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8z"/>
            </svg>
            <span class="nav-text">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å</span>
        </a>
        
        <a class="nav-item" onclick="navigateTo('companions')">
            <svg class="nav-icon" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"/>
            </svg>
            <span class="nav-text">–ö–æ–º–ø–∞–Ω—å–æ–Ω—ã</span>
        </a>
    </nav>

    <script>
        // CHARACTERS DATA - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0
        const characters = [
            {
                emoji: "üòá",
                name: "Lila",
                age: 22,
                personality: "–ú–∏–ª–∞—è –∏ –Ω–µ–≤–∏–Ω–Ω–∞—è",
                image: "https://images.unsplash.com/photo-1494790108755-2616b612b1e4?w=400&h=600&fit=crop&crop=face"
            },
            {
                emoji: "üòà",
                name: "Roxy",
                age: 24,
                personality: "–î–µ—Ä–∑–∫–∞—è –∏ –∏–≥—Ä–∏–≤–∞—è",
                image: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=400&h=600&fit=crop&crop=face"
            },
            {
                emoji: "üß†",
                name: "Elara",
                age: 26,
                personality: "–£–º–Ω–∞—è –∏ –∑–∞–≥–∞–¥–æ—á–Ω–∞—è",
                image: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=400&h=600&fit=crop&crop=face"
            },
            {
                emoji: "üé®",
                name: "Chloe",
                age: 21,
                personality: "–¢–≤–æ—Ä—á–µ—Å–∫–∞—è –∏ –º–µ—á—Ç–∞—Ç–µ–ª—å–Ω–∞—è",
                image: "https://images.unsplash.com/photo-1488716820095-cbe80883c496?w=400&h=600&fit=crop&crop=face"
            },
            {
                emoji: "üî•",
                name: "Seraphina",
                age: 25,
                personality: "–°—Ç—Ä–∞—Å—Ç–Ω–∞—è –∏ —É–≤–µ—Ä–µ–Ω–Ω–∞—è",
                image: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=400&h=600&fit=crop&crop=face"
            },
            {
                emoji: "üòä",
                name: "Mia",
                age: 23,
                personality: "–î–æ–±—Ä–∞—è –∏ –∑–∞–±–æ—Ç–ª–∏–≤–∞—è",
                image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=400&h=600&fit=crop&crop=face"
            }
        ];

        // CATALOG CHARACTERS - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0
        const catalogCharacters = [
            // Anime
            { name: "Lila", age: 18, image: "https://images.unsplash.com/photo-1494790108755-2616b612b1e4?w=180&h=240&fit=crop&crop=face", tag: "–ê–Ω–∏–º–µ" },
            { name: "Aria", age: 25, image: "https://images.unsplash.com/photo-1534528741775-53994a69daeb?w=180&h=240&fit=crop&crop=face", tag: "–ê–Ω–∏–º–µ" },
            { name: "Kiana", age: 37, image: "https://images.unsplash.com/photo-1544005313-94ddf0286df2?w=180&h=240&fit=crop&crop=face", tag: "–ê–Ω–∏–º–µ" },
            { name: "Miki", age: 20, image: "https://images.unsplash.com/photo-1488716820095-cbe80883c496?w=180&h=240&fit=crop&crop=face", tag: "–ê–Ω–∏–º–µ" },
            { name: "Yuna", age: 22, image: "https://images.unsplash.com/photo-1529626455594-4ff0802cfb7e?w=180&h=240&fit=crop&crop=face", tag: "–ê–Ω–∏–º–µ" },
            // Real
            { name: "Serena", age: 28, image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?w=180&h=240&fit=crop&crop=face", tag: "–†–µ–∞–ª—å–Ω—ã–π" },
            { name: "Chloe", age: 24, image: "https://images.unsplash.com/photo-1524504388940-b1c1722653e1?w=180&h=240&fit=crop&crop=face", tag: "–†–µ–∞–ª—å–Ω—ã–π" },
            { name: "Isabella", age: 26, image: "https://images.unsplash.com/photo-1531746020798-e6953c6e8e04?w=180&h=240&fit=crop&crop=face", tag: "–†–µ–∞–ª—å–Ω—ã–π" },
            { name: "Zoe", age: 21, image: "https://images.unsplash.com/photo-1502823403499-6ccfcf4fb453?w=180&h=240&fit=crop&crop=face", tag: "–†–µ–∞–ª—å–Ω—ã–π" },
            { name: "Olivia", age: 29, image: "https://images.unsplash.com/photo-1509967419530-da38b4704bc6?w=180&h=240&fit=crop&crop=face", tag: "–†–µ–∞–ª—å–Ω—ã–π" }
        ];

                 // GALLERY VARIABLES - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—É—Å–µ–ª—å
         let activeIndex = 0;
         let autoRotateInterval;
         const totalCharacters = characters.length;
         const angle = 360 / totalCharacters;
         let currentRotation = 0;
         let isDragging = false;
         let startX = 0;

         // CURRENT FILTER
         let currentFilter = "–í—Å–µ –º–æ–¥–µ–ª–∏";

         // DYNAMIC TEXT VARIABLES
         const textVariants = [
             '—Å–≤–æ–µ–≥–æ —Å–ø—É—Ç–Ω–∏–∫–∞',
             '—Å–≤–æ—é –¥–µ–≤—É—à–∫—É', 
             '—Å–≤–æ–µ–≥–æ –¥—Ä—É–≥–∞',
             '—Å–≤–æ—é –ø–æ–¥—Ä—É–≥—É',
             '—Å–≤–æ–µ–≥–æ –∫–æ–ª–ª–µ–≥—É',
             '—Å–≤–æ—é –∫–æ–ª–ª–µ–≥—É',
             '—Å–≤–æ–µ–≥–æ –ø–∞—Ä–Ω—è',
             '—Å–≤–æ—é —Å–ø—É—Ç–Ω–∏—Ü—É',
             '—Å–≤–æ–µ–≥–æ –∫–æ–º–ø–∞–Ω—å–æ–Ω–∞',
             '—Å–≤–æ—é –∫–æ–º–ø–∞–Ω—å–æ–Ω–∫—É'
         ];
         let currentTextIndex = 0;

                 // INIT
         document.addEventListener('DOMContentLoaded', function() {
             createGallery();
             createCatalog();
             startAutoRotate();
             startDynamicText();
             
             if (window.Telegram?.WebApp) {
                 window.Telegram.WebApp.ready();
                 window.Telegram.WebApp.expand();
             }
         });

                 // CREATE GALLERY - –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –∫–∞—Ä—É—Å–µ–ª—å
         function createGallery() {
             const carousel = document.getElementById('carousel');
             
             characters.forEach((char, index) => {
                 const rotation = index * angle;
                 const isCenter = index === activeIndex;
                 const zDist = Math.abs(index - activeIndex);
                 const zIndex = totalCharacters - Math.min(zDist, totalCharacters - zDist);
                 
                 const card = document.createElement('div');
                 card.className = 'character-card';
                 card.style.transform = `rotateY(${rotation}deg) translateZ(200px)`;
                 card.style.zIndex = zIndex;
                 
                 card.innerHTML = `
                     <div class="card-inner ${isCenter ? 'center' : ''}">
                         <img class="card-image" src="${char.image}" alt="${char.name}" loading="lazy">
                         <div class="card-overlay"></div>
                         <div class="card-content">
                             <p class="card-emoji">${char.emoji}</p>
                             <h3 class="card-name">
                                 ${char.name}, <span class="card-age">${char.age}</span>
                             </h3>
                             <p class="card-personality">${char.personality}</p>
                         </div>
                     </div>
                 `;
                 
                 card.onclick = () => selectCharacter(index);
                 carousel.appendChild(card);
             });

                           // –î–æ–±–∞–≤–ª—è–µ–º —Å–æ–±—ã—Ç–∏—è –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
              carousel.addEventListener('mousedown', startDrag);
              carousel.addEventListener('touchstart', startTouch);
              document.addEventListener('mousemove', drag);
              document.addEventListener('touchmove', dragTouch);
              document.addEventListener('mouseup', endDrag);
              document.addEventListener('touchend', endDrag);
          }

                 // AUTO ROTATE
         function startAutoRotate() {
             autoRotateInterval = setInterval(() => {
                 if (!isDragging) {
                     nextCharacter();
                 }
             }, 3000);
         }

         function stopAutoRotate() {
             clearInterval(autoRotateInterval);
         }

         function nextCharacter() {
             activeIndex = (activeIndex + 1) % totalCharacters;
             rotateCarousel();
         }

         function rotateCarousel() {
             const targetRotation = -activeIndex * angle;
             currentRotation = targetRotation;
             
             const carousel = document.getElementById('carousel');
             carousel.style.transform = `rotateY(${currentRotation}deg)`;
             
             // Update center card
             const cards = carousel.querySelectorAll('.card-inner');
             cards.forEach((card, index) => {
                 card.classList.toggle('center', index === activeIndex);
             });
         }

         function updateGallery() {
             rotateCarousel();
         }

         function selectCharacter(index) {
             activeIndex = index;
             updateGallery();
             
             if (window.Telegram?.WebApp) {
                 const data = {
                     action: 'select_character',
                     character: characters[index].name
                 };
                 window.Telegram.WebApp.sendData(JSON.stringify(data));
             }
         }

         // DRAG HANDLERS
         function startDrag(e) {
             isDragging = true;
             startX = e.clientX;
             stopAutoRotate();
             
             const angle = 360 / characters.length;
             currentRotation = -activeIndex * angle;
         }

         function startTouch(e) {
             e.preventDefault();
             isDragging = true;
             startX = e.touches[0].clientX;
             stopAutoRotate();
             
             const angle = 360 / characters.length;
             currentRotation = -activeIndex * angle;
         }

         function drag(e) {
             if (!isDragging) return;
             
             const deltaX = (e.clientX - startX) * 0.5;
             const maxDelta = 10;
             const limitedDelta = Math.max(-maxDelta, Math.min(maxDelta, deltaX));
             
             const carousel = document.getElementById('carousel');
             carousel.style.transform = `rotateY(${currentRotation + limitedDelta}deg)`;
         }

         function dragTouch(e) {
             if (!isDragging) return;
             e.preventDefault();
             
             const deltaX = (e.touches[0].clientX - startX) * 0.5;
             const maxDelta = 10;
             const limitedDelta = Math.max(-maxDelta, Math.min(maxDelta, deltaX));
             
             const carousel = document.getElementById('carousel');
             carousel.style.transform = `rotateY(${currentRotation + limitedDelta}deg)`;
         }

         function endDrag() {
             if (!isDragging) return;
             isDragging = false;
             
             // Snap to nearest card
             const angle = 360 / characters.length;
             const closestIndex = Math.round(-currentRotation / angle);
             activeIndex = ((closestIndex % characters.length) + characters.length) % characters.length;
             
             rotateCarousel();
             startAutoRotate();
         }

         // DYNAMIC TEXT
         function startDynamicText() {
             setInterval(() => {
                 currentTextIndex = (currentTextIndex + 1) % textVariants.length;
                 updateDynamicText();
             }, 3000);
         }

         function updateDynamicText() {
             const textElement = document.getElementById('dynamicText');
             textElement.style.opacity = '0';
             
             setTimeout(() => {
                 textElement.textContent = textVariants[currentTextIndex];
                 textElement.style.opacity = '1';
             }, 150);
         }

        // CREATE CATALOG - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0
        function createCatalog() {
            const grid = document.getElementById('catalog-grid');
            
            // Create companion card - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0
            const createCard = document.createElement('div');
            createCard.className = 'create-companion-card';
            createCard.innerHTML = `
                <img class="create-companion-image" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='180' height='240' viewBox='0 0 180 240'%3E%3Crect width='180' height='240' fill='%23374151'/%3E%3C/svg%3E" alt="–°–æ–∑–¥–∞—Ç—å —Å–ø—É—Ç–Ω–∏–∫–∞">
                <div class="create-companion-overlay"></div>
                <div class="create-companion-content">
                    <svg class="create-fish-icon" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2C13.1 2 14 2.9 14 4C14 5.1 13.1 6 12 6C10.9 6 10 5.1 10 4C10 2.9 10.9 2 12 2Z"/>
                    </svg>
                    <h3 class="create-companion-title">–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–µ–≥–æ —Å–ø—É—Ç–Ω–∏–∫–∞</h3>
                </div>
            `;
            createCard.onclick = () => navigateTo('create');
            grid.appendChild(createCard);
            
            // Add character cards
            const filteredCharacters = currentFilter === "–í—Å–µ –º–æ–¥–µ–ª–∏" 
                ? catalogCharacters 
                : catalogCharacters.filter(c => c.tag === currentFilter);
            
            filteredCharacters.forEach(char => {
                const card = document.createElement('div');
                card.className = 'catalog-card';
                card.dataset.tag = char.tag;
                
                card.innerHTML = `
                    <img class="catalog-card-image" src="${char.image}" alt="${char.name}" loading="lazy">
                    <div class="catalog-card-overlay"></div>
                    <div class="catalog-card-tag">${char.tag}</div>
                    <div class="catalog-card-info">
                        <h3 class="catalog-card-name">
                            ${char.name} <span class="catalog-card-age">${char.age}</span>
                        </h3>
                    </div>
                    <button class="catalog-card-add" onclick="event.stopPropagation(); addCharacter('${char.name}')">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/>
                        </svg>
                    </button>
                `;
                
                card.onclick = () => selectCatalogCharacter(char);
                grid.appendChild(card);
            });
        }

        function addCharacter(name) {
            if (window.Telegram?.WebApp) {
                const data = {
                    action: 'add_character',
                    character: name
                };
                window.Telegram.WebApp.sendData(JSON.stringify(data));
            }
        }

        function selectCatalogCharacter(char) {
            if (window.Telegram?.WebApp) {
                const data = {
                    action: 'select_character',
                    character: char.name
                };
                window.Telegram.WebApp.sendData(JSON.stringify(data));
            }
        }

        // FILTER CATALOG - —Ç–æ—á–Ω–æ –∫–∞–∫ –≤ v0
        function filterCatalog(filter) {
            currentFilter = filter;
            
            // Update active filter button
            document.querySelectorAll('.filter-button').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Recreate catalog
            const grid = document.getElementById('catalog-grid');
            grid.innerHTML = '';
            createCatalog();
        }

        // NAVIGATION
        function navigateTo(page) {
            // Hide all pages
            document.querySelectorAll('.page').forEach(p => {
                p.classList.remove('active');
            });
            
            // Show target page
            document.getElementById('page-' + page).classList.add('active');
            
            // Update navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeNav = document.querySelector(`.nav-item[onclick="navigateTo('${page}')"]`);
            if (activeNav && !activeNav.classList.contains('create')) {
                activeNav.classList.add('active');
                // Add/remove dot
                const existingDots = document.querySelectorAll('.nav-dot');
                existingDots.forEach(dot => dot.remove());
                
                if (page === 'home') {
                    const dot = document.createElement('div');
                    dot.className = 'nav-dot';
                    activeNav.appendChild(dot);
                }
            }
            
            // Send to Telegram
            if (window.Telegram?.WebApp) {
                const data = {
                    action: 'navigate',
                    page: page
                };
                window.Telegram.WebApp.sendData(JSON.stringify(data));
            }
        }
    </script>
</body>
</html>
